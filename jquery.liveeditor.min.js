(function(e,t,n,r){function l(){b(e(this))}function c(){E(this)}function h(){var t=e(this).unbind("focus",h).select();var n=t.parent().unbind("mouseleave",c);var r=n.data(i);if(n[0]===r._focusedContainer){return true}if(r._focusedContainer){if(!E(r._focusedContainer))return false}r._focusedContainer=n[0];t.keydown(p);if(e.isFunction(r.onEditorFocused)){r.onEditorFocused.call(n,t)}return true}function p(t){var n=t.keyCode||t.which;if(n==13){t.preventDefault();var r=e(this).parent();E(r)}else if(n==27){t.preventDefault();var r=e(this).parent();E(r)}else if(n==9){t.preventDefault();var r=e(this).parent();var s=r.data(i);E(r);if(t.shiftKey){var o=s._selector.last();s._selector.each(function(){if(this===r[0])return false;o=e(this)})}else{var u=false;o=s._selector.eq(0);s._selector.each(function(){if(u){o=e(this);return false}else if(this===r[0]){u=true}})}b(o).focus()}}function d(e){if(e.data(o)!==true){e.data(o,true).mouseenter(l)}return e}function v(e){if(e.data(o)===true){e.data(o,false).unbind("mouseenter",l)}return e}function m(t){var n;var r=t.data(i);if(e.isFunction(r.onGetValue)){n=r.onGetValue.call(t)}if(!n){n=t.hasClass(r.combobox.css)||t.hasClass(r.checkbox.css)?t.attr("value"):t.text()}return n}function g(t,n,o){var u;var a=t.data(s);var f=t.data(i);if(e.isFunction(f.onSetValue)){var u=f.onSetValue.call(t,value,html);if(u===false)return false}if(u===r){if(t.hasClass(f.combobox.css)){t.attr("value",n)}else if(t.hasClass(f.checkbox.css)){t.attr("value",n);o=n==f.checkbox.checked.value?f.checkbox.checked.html:f.checkbox.unchecked.html}if(o===null||o===r)o=n;t.html(o)}t.unbind("mouseleave",c).removeClass(f.editingCss);if(t[0]===f._focusedContainer){f._focusedContainer=null}if(n!=a){if(f.changedCss)t.addClass(f.changedCss)}else{if(f.changedCss)t.removeClass(f.changedCss)}return true}function y(t){var n=t.data(i);if(e.isFunction(n.onChanged)){n.onChanged.call(t)}}function b(t){var n=t.data(i);var o=t.children(0);if(o.data(u)){return o}var a=m(t);if(t.data(s)===r){t.data(s,a)}var o=w(t,a);o.focus(h);t.html(o).mouseleave(c).addClass(n.editingCss);if(e.isFunction(n.onEditorOpened)){n.onEditorOpened.call(t,o)}return o}function w(t,n){var r;var s=t.data(i);var o=s.onEditorCreating;if(o){r=o(t,n)}if(!r){if(t.hasClass(s.combobox.css)){r=e("<select>").width(t.width()-f);var a=s.onEditorOptions.call(t);switch(e.type(a)){case"string":r.append(e(a));break;default:break}e('option[value="'+n+'"]',r).prop("selected",true)}else if(t.hasClass(s.checkbox.css))r=e('<input type="checkbox"/>').prop("checked",n==s.checkbox.checked.value);else{r=e('<input type="text"/>').width(t.width()-f).val(n)}}r.data(u,n);if(s.editorCss){r.addClass(s.editorCss)}return r}function E(t){var n=e(t);var r=n.children(0);if(!r.length){return true}var s=r.data(u);var o=S(r);var a=x(r);if(!g(n,o,a)){return false}var f=n.data(i);if(s!=o){y(n)}if(e.isFunction(f.onEditorClosed)){f.onEditorClosed.call(n)}return true}function S(t){var n;var r=t.parent();var s=r.data(i);if(e.isFunction(s.onEditorGetValue)){n=s.onEditorGetValue.call(t)}if(!n){if(t.is(":checkbox"))n=t.prop("checked")?s.checkbox.checked.value:s.checkbox.unchecked.value;else if(t.is("select"))n=e("option:selected",t).val();else n=t.val()}return n}function x(t){var n;var r=t.parent();var s=r.data(i);if(e.isFunction(s.onEditorGetValue)){n=s.onEditorGetHtml.call(t)}if(t.is("select"))n=e(":selected",t).text();else n=null;return n}function T(t,n){e(t).data(i,n)}var i="liveeditor-options";var s="liveeditor-old";var o="liveeditor-enabled";var u="liveeditor-original";var a={changedCss:"liveeditor-changed",editingCss:null,editorCss:null,combobox:{css:"combo"},checkbox:{css:"checkbox",checked:{value:"true",html:"X"},unchecked:{value:"false",html:""}},onGetValue:null,onSetValue:null,onChanged:null,onEditorCreating:null,onEditorOptions:function(e){return'<option value=""></option>'},onEditorOpened:null,onEditorFocused:null,onEditorClosed:null};var f=5;e.liveeditor={enable:function(e){return d(e)},disable:function(e){return v(e)},closeEditor:function(e){e.each(function(){E(this)});return e},get:function(t){var n=[];t.each(function(){var t=m(e(this));n.push(t)});return n.length===1?n[0]:n},serialize:function(t,n){var r=[];t.filter(function(){var t=e(this);return(n||t.is("[name]"))&&t.data(i)}).each(function(){var t=e(this);var i=t.attr("name")||n.eq(t.index()).attr("name");r.push(encodeURIComponent(i)+"="+encodeURIComponent(m(t)))});return r.join("&")},set:function(t,n,i){t.each(function(){var t=e(this);var o=m(t);if(t.data(s)===r){t.data(s,o)}if(g(t,n,i)){if(n!==o){y(t)}}});return t},reset:function(t){t.each(function(){var t=e(this);var n=t.data(s);if(n){var r=m(t);if(r!==n){t.removeData(s);var o=t.data(i);if(o.changedCss)t.removeClass(o.changedCss);y(t)}}});return t}};e.fn.liveeditor=function(t){var n=e.extend({},a,t);n._focusedContainer=null;n._selector=this;this.each(function(){T(this,n)});e.liveeditor.enable(this);return this}})(jQuery,window,document)