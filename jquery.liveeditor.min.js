(function(e){function r(){h(e(this))}function i(){d(this)}function s(){var t=e(this).unbind("focus",s).select();var n=t.parent().unbind("mouseleave",i);var r=n.data("liveeditor-options");if(n[0]===r._focusedContainer){return true}if(r._focusedContainer){if(!d(r._focusedContainer))return false}r._focusedContainer=n[0];t.keydown(o);if(e.isFunction(r.onEditorFocused)){r.onEditorFocused.call(n,t)}return true}function o(t){var n=t.keyCode||t.which;if(n==13){t.preventDefault();var r=e(this).parent();d(r)}else if(n==27){t.preventDefault();var r=e(this).parent();d(r)}else if(n==9){t.preventDefault();var r=e(this).parent();var i=r.data("liveeditor-options");d(r);if(t.shiftKey){var s=i._selector.last();i._selector.each(function(){if(this===r[0])return false;s=e(this)})}else{var o=false;s=i._selector.eq(0);i._selector.each(function(){if(o){s=e(this);return false}else if(this===r[0]){o=true}})}h(s).focus()}}function u(e){if(e.data("liveeditor-enabled")!==true){e.data("liveeditor-enabled",true).mouseenter(r)}return e}function a(e){if(e.data("liveeditor-enabled")===true){e.data("liveeditor-enabled",false).unbind("mouseenter",r)}return e}function f(t){var n;var r=t.data("liveeditor-options");if(e.isFunction(r.onGetValue)){n=r.onGetValue.call(t)}if(!n){n=t.hasClass(r.combobox.css)||t.hasClass(r.checkbox.css)?t.attr("value"):t.text()}return n}function l(t,n,r){var s;var o=t.data("liveeditor-old");var u=t.data("liveeditor-options");if(e.isFunction(u.onSetValue)){var s=u.onSetValue.call(t,value,html);if(s===false)return false}if(s===undefined){if(t.hasClass(u.combobox.css)){t.attr("value",n)}else if(t.hasClass(u.checkbox.css)){t.attr("value",n);r=n==u.checkbox.checked.value?u.checkbox.checked.html:u.checkbox.unchecked.html}if(r===null||r===undefined)r=n;t.html(r)}t.unbind("mouseleave",i);if(t[0]===u._focusedContainer){u._focusedContainer=null}if(n!=o){if(u.changedCss)t.addClass(u.changedCss)}else{if(u.changedCss)t.removeClass(u.changedCss)}return true}function c(t){var n=t.data("liveeditor-options");if(e.isFunction(n.onChanged)){n.onChanged.call(t)}}function h(t){var n=t.data("liveeditor-options");var r=t.children(0);if(r.data("liveeditor-original")){return r}var o=f(t);if(t.data("liveeditor-old")===undefined){t.data("liveeditor-old",o)}var r=p(t,o);r.focus(s);t.html(r).mouseleave(i);if(e.isFunction(n.onEditorOpened)){n.onEditorOpened.call(t,r)}return r}function p(t,r){var i;var s=t.data("liveeditor-options");var o=s.onEditorCreating;if(o){i=o(t,r)}if(!i){if(t.hasClass(s.combobox.css)){i=e("<select>").width(t.width()-n);var u=s.onEditorOptions.call(t);switch(e.type(u)){case"string":i.append(e(u));break;default:break}e('option[value="'+r+'"]',i).prop("selected",true)}else if(t.hasClass(s.checkbox.css))i=e('<input type="checkbox"/>').prop("checked",r==s.checkbox.checked.value);else{i=e('<input type="text"/>').width(t.width()-n).val(r)}}i.data("liveeditor-original",r);if(s.editorCss){i.addClass(s.editorCss)}return i}function d(t){var n=e(t);var r=n.children(0);if(!r.length){return true}var i=r.data("liveeditor-original");var s=v(r);var o=m(r);if(!l(n,s,o)){return false}var u=n.data("liveeditor-options");if(i!=s){c(n)}if(e.isFunction(u.onEditorClosed)){u.onEditorClosed.call(n)}return true}function v(t){var n;var r=t.parent();var i=r.data("liveeditor-options");if(e.isFunction(i.onEditorGetValue)){n=i.onEditorGetValue.call(t)}if(!n){if(t.is(":checkbox"))n=t.prop("checked")?i.checkbox.checked.value:i.checkbox.unchecked.value;else if(t.is("select"))n=e("option:selected",t).val();else n=t.val()}return n}function m(t){var n;var r=t.parent();var i=r.data("liveeditor-options");if(e.isFunction(i.onEditorGetValue)){n=i.onEditorGetHtml.call(t)}if(t.is("select"))n=e(":selected",t).text();else n=null;return n}function g(t,n){e(t).data("liveeditor-options",n)}var t={changedCss:"liveeditor-changed",editorCss:null,combobox:{css:"combo"},checkbox:{css:"checkbox",checked:{value:"true",html:"X"},unchecked:{value:"false",html:""}},onGetValue:null,onSetValue:null,onChanged:null,onEditorCreating:null,onEditorOptions:function(e){return'<option value=""></option>'},onEditorOpened:null,onEditorFocused:null,onEditorClosed:null};var n=5;e.liveeditor={enable:function(e){return u(e)},disable:function(e){return a(e)},closeEditor:function(e){e.each(function(){d(this)});return e},set:function(t,n,r){t.each(function(){var t=e(this);var i=f(t);if(t.data("liveeditor-old")===undefined){t.data("liveeditor-old",i)}if(l(t,n,r)){if(n!==i){c(t)}}});return t},reset:function(t){t.each(function(){var t=e(this);var n=t.data("liveeditor-old");if(n){var r=f(t);if(r!==n){t.removeData("liveeditor-old");var i=t.data("liveeditor-options");if(i.changedCss)t.removeClass(i.changedCss);c(t)}}});return t}};e.fn.liveeditor=function(n){var r=e.extend({},t,n);r._focusedContainer=null;r._selector=this;this.each(function(){g(this,r)});e.liveeditor.enable(this);return this}})(jQuery)