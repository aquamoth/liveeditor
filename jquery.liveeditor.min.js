(function(e,t,n,r){function l(){b(e(this))}function c(){E(this)}function h(){var t=e(this).unbind("focus",h).select();var n=t.parent().unbind("mouseleave",c);var r=n.data(i);if(n[0]===r._focusedContainer){return true}if(r._focusedContainer){if(!E(r._focusedContainer))return false}r._focusedContainer=n[0];t.keydown(p);if(e.isFunction(r.onEditorFocused)){r.onEditorFocused.call(n,t)}return true}function p(t){var n=t.keyCode||t.which;if(n==13){t.preventDefault();var r=e(this).parent();E(r)}else if(n==27){t.preventDefault();var r=e(this).parent();E(r)}else if(n==9){t.preventDefault();var r=e(this).parent();var s=r.data(i);E(r);var u=t.shiftKey?e(s._selector.get().reverse()):s._selector;var a=null;var f=false;do{u.each(function(){if(f&&e(this).data(o)===true){a=e(this);return false}else if(this===r[0]){if(f){f=false;return false}else{f=true}}});if(!f){break}}while(a==null);if(a!==null){b(a).focus()}}}function d(e){if(e.data(o)!==true){e.data(o,true).mouseenter(l)}return e}function v(e){if(e.data(o)===true){e.data(o,false).unbind("mouseenter",l)}return e}function m(t){var n;var s=t.data(i);if(e.isFunction(s.onGetValue)){n=s.onGetValue.call(t)}if(n===r){n=t.hasClass(s.combobox.css)||t.hasClass(s.checkbox.css)?t.attr("value"):t.text()}return n}function g(t,n,o){var u;var a=t.data(i);if(e.isFunction(a.onSetValue)){var u=a.onSetValue.call(t,n,o);if(u===false)return false}if(u===r){if(t.hasClass(a.combobox.css)){t.attr("value",n)}else if(t.hasClass(a.checkbox.css)){t.attr("value",n);if(o===null)o=n==a.checkbox.checked.value?a.checkbox.checked.html:a.checkbox.unchecked.html}if(o===null||o===r)o=n;t.html(o)}t.unbind("mouseleave",c).removeClass(a.editingCss);if(t[0]===a._focusedContainer){a._focusedContainer=null}var f=t.data(s);if(n!=f){if(a.changedCss)t.addClass(a.changedCss)}else{if(a.changedCss)t.removeClass(a.changedCss)}return true}function y(t){var n=t.data(i);if(e.isFunction(n.onChanged)){n.onChanged.call(t)}}function b(t){var n=t.data(i);var o=t.children(0);if(o.data(u)!==r){return o}var a=m(t);if(t.data(s)===r){t.data(s,a)}var o=w(t,a);o.focus(h);t.html(o).mouseleave(c).addClass(n.editingCss);if(e.isFunction(n.onEditorOpened)){n.onEditorOpened.call(t,o)}return o}function w(t,n){var r;var s=t.data(i);var o=s.onEditorCreating;if(o){r=o(t,n)}if(!r){if(t.hasClass(s.combobox.css)){r=e("<select>").width(t.width()-f);var a=s.onEditorOptions.call(t);switch(e.type(a)){case"string":r.append(e(a));break;default:break}e('option[value="'+n+'"]',r).prop("selected",true)}else if(t.hasClass(s.checkbox.css))r=e('<input type="checkbox"/>').prop("checked",n==s.checkbox.checked.value);else{r=e('<input type="text"/>').width(t.width()-f).val(n)}}r.data(u,n);if(s.editorCss){r.addClass(s.editorCss)}return r}function E(t){var n=e(t);var s=n.children(0);if(!s.length||s.data(u)===r){return true}var o=s.data(u);var a=S(s);var f=x(s);if(!g(n,a,f)){return false}var l=n.data(i);if(o!=a){y(n)}if(e.isFunction(l.onEditorClosed)){l.onEditorClosed.call(n)}return true}function S(t){var n;var s=t.parent();var o=s.data(i);if(e.isFunction(o.onEditorGetValue)){n=o.onEditorGetValue.call(t)}if(n===r){if(t.is(":checkbox"))n=t.prop("checked")?o.checkbox.checked.value:o.checkbox.unchecked.value;else if(t.is("select"))n=e("option:selected",t).val();else n=t.val()}return n}function x(t){var n;var s=t.parent();var o=s.data(i);if(e.isFunction(o.onEditorGetValue)){n=o.onEditorGetHtml.call(t)}if(n===r){if(t.is("select"))n=e(":selected",t).text();else n=null}return n}function T(t,n){e(t).data(i,n)}var i="liveeditor-options";var s="liveeditor-old";var o="liveeditor-enabled";var u="liveeditor-original";var a={changedCss:"liveeditor-changed",editingCss:null,editorCss:null,combobox:{css:"combo"},checkbox:{css:"checkbox",checked:{value:"true",html:"X"},unchecked:{value:"false",html:""}},onGetValue:null,onSetValue:null,onChanged:null,onEditorCreating:null,onEditorOptions:function(e){return'<option value=""></option>'},onEditorOpened:null,onEditorFocused:null,onEditorClosed:null};var f=5;e.liveeditor={enable:function(e){return d(e)},disable:function(e){return v(e)},closeEditor:function(e){e.each(function(){E(this)});return e},get:function(t){var n=[];t.each(function(){var t=m(e(this));n.push(t)});return n.length===1?n[0]:n},serialize:function(t,n){var r=[];t.filter(function(){var t=e(this);return(n||t.is("[name]"))&&t.data(i)}).each(function(){var t=e(this);var i=t.attr("name")||n.eq(t.index()).attr("name");r.push(encodeURIComponent(i)+"="+encodeURIComponent(m(t)))});return r.join("&")},serializeRow:function(t,n){var s=e(t).get(0);var o=[];e("*",t).filter(function(){return e(this).data(i)}).each(function(){var t=e(this);var i=m(t);var u=[];while(t.get(0)!=s){u.push(t.index());t=t.parent();if(t.index()===-1)break}u=u.reverse();t=n;for(var a in u){t=t.children().eq(u[a])}var f=t.attr("name");if(f!==r){o.push(encodeURIComponent(f)+"="+encodeURIComponent(i))}else{}});return o.join("&")},set:function(t,n,i){t.each(function(){var t=e(this);var o=m(t);if(t.data(s)===r){t.data(s,o)}if(g(t,n,i)){var u=t.data(s);if(n!==u){y(t)}}});return t},reset:function(t){t.each(function(){var t=e(this);var n=t.data(s);if(n!==r){var o=m(t);if(o!==n){t.data(s,o);var u=t.data(i);if(u.changedCss)t.removeClass(u.changedCss);y(t)}}else{}});return t}};e.fn.liveeditor=function(t){var n=e.extend({},a,t);n._focusedContainer=null;n._selector=this;this.each(function(){T(this,n)});e.liveeditor.enable(this);return this}})(jQuery,window,document)